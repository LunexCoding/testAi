<UserControl 
    x:Class="OrderApprovalSystem.Views.OrderApprovalView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ribbon="clr-namespace:System.Windows.Controls.Ribbon;assembly=System.Windows.Controls.Ribbon"
    xmlns:local="clr-namespace:OrderApprovalSystem.Views"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:behaviors="clr-namespace:OrderApprovalSystem.Behaviors"
    xmlns:converters="clr-namespace:OrderApprovalSystem.Converters" 
    xmlns:vm="clr-namespace:OrderApprovalSystem.ViewModels"
    Background="{DynamicResource PrimaryBackgroundBrush}"
    Foreground="{DynamicResource TextBrush}">

    <UserControl.Resources>
        <converters:IsByMemoToTextConverter x:Key="IsByMemoToTextConverter"/>
        <converters:MaskedDateConverter x:Key="MaskedDateConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    </UserControl.Resources>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:CallMethodAction TargetObject="{Binding}" MethodName="viewLoaded"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.40*"/>
            <ColumnDefinition Width="0.3*"/>
            <ColumnDefinition Width="0.30*"/>
        </Grid.ColumnDefinitions>

        <!-- Левая панель со списком заказов -->
        <Border Grid.Column="0" 
                Margin="5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource AccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                        Background="{DynamicResource AccentBrush}"
                        CornerRadius="2,2,0,0"
                        Padding="10">
                    <TextBlock Text="Технологические заказы"
                               Foreground="White"
                               FontSize="14"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"/>
                </Border>

                <DataGrid Grid.Row="1"
                          IsReadOnly="True"
                          AutoGenerateColumns="False"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          HorizontalScrollBarVisibility="Disabled"
                          CanUserAddRows="False"
                          x:Name="dgReport" 
                          ItemsSource="{Binding model.GroupedData}" 
                          SelectedItem="{Binding model.CurrentGroup, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasRework}" Value="True">
                                    <Setter Property="Background" Value="Red"/>
                                </DataTrigger>

                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <i:Interaction.Behaviors>
                        <behaviors:ScrollIntoViewBehavior SelectedItem="{Binding model.CurrentGroup, Mode=OneWay}"/>
                    </i:Interaction.Behaviors>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Тех. заказ" 
                                            Binding="{Binding Zak1}" 
                                            Width="80"/>
                        <DataGridTextColumn Header="Кол-во чертежей" 
                                            Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Items.Count}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsByMemo}" Value="True">
                                            <Setter Property="Text" Value=""/>
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Дата" Width="Auto">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Items[0].OpenAtByTechnologist, StringFormat=\{0:dd.MM.yyyy\}}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsByMemo}" Value="True">
                                            <Setter Property="Text" Value=""/>
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Чертеж ДСЕ" Width="Auto">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Items[0].Draft}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsByMemo}" Value="True">
                                            <Setter Property="Text" Value=""/>
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Наименование" Width="*" CellStyle="{DynamicResource LeftAlignedDataGridCell}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="{Binding Items[0].DraftName}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsByMemo}" Value="True">
                                            <Setter Property="Text" Value=""/>
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Тип" Width="Auto" CellStyle="{DynamicResource LeftAlignedDataGridCell}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="IsByMemo">
                                    <Binding.Converter>
                                        <converters:IsByMemoToTextConverter/>
                                    </Binding.Converter>
                                </Binding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Центральная панель с деталями заказа -->
        <Border Grid.Column="1" 
                Margin="0,5,0,5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource GreenAccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4"
                Padding="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid IsSharedSizeScope="True">
                    <StackPanel>
                        <TextBlock FontSize="16" FontWeight="Bold" HorizontalAlignment="Center"
                                   Foreground="{DynamicResource TextBrush}" Margin="0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="Данные тех. заказа"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Технолог -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Технолог:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Technologist}" 
                                Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                            <!-- Изделие -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Изделие:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.CoreDraft}" 
                                Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Наименование изделия -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование изделия:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.CoreDraftName}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Деталь -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Деталь:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Draft}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Наименование детали -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование детали:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.DraftName}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Цех получатель -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Цех получ.:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Workshop}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Кладовая -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Кладовая:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Warehouse}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Рабочее место -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Раб. место:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Workplace}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Операция -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Операция:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Operation}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Наименование оснастки -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование оснастки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.EquipmentName}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Аналог -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Аналог:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Analog}" 
                   Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Количество оснастки на операцию -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Кол-во оснастки на операцию:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.EquipmentQuantityForOperation}" 
                                Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <!-- ==================== ПОЛЯ ДЛЯ РОЛЕЙ С ПРАВАМИ РЕДАКТИРОВАНИЯ ==================== -->
                        <!-- Заголовок блока данных заказа (только для OrderManager) -->
                        <TextBlock Text="Данные заказа"
                           FontSize="16" FontWeight="Bold" HorizontalAlignment="Center"
                           Foreground="{DynamicResource TextBrush}" Margin="0,10,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Номер служебной записки (только при IsByMemo = True) -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding ShowMemoFieldsOrView}" Value="True"/>
                                                <Condition Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номер служебной записки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.MemoNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding ShowMemoFieldsOrView}" Value="True"/>
                                                <Condition Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Автор служебной записки (только при IsByMemo = True) -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding ShowMemoFieldsOrView}" Value="True"/>
                                                <Condition Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Автор служебной записки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.MemoAuthor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding ShowMemoFieldsOrView}" Value="True"/>
                                                <Condition Binding="{Binding model.CurrentGroup.IsByMemo}" Value="True"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Заказ по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Заказ:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.OrderByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Номер по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номер:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.NumberByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Основной заказ по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Основной заказ:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.CoreOrderByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Номер основного заказа по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номер основного заказа:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.CoreNumberByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Наименование заказа по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование заказа:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                             Text="{Binding model.CurrentItem.OrderName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource AttributeTextBoxStyle}"
                             IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Дата открытия заказа -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Дата открытия заказа:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                             Text="{Binding model.CurrentItem.OpenAtByMemo, Mode=TwoWay, UpdateSourceTrigger=LostFocus, Converter={StaticResource MaskedDateConverter}, StringFormat='{}{0:dd.MM.yyyy}'}"
                             Style="{StaticResource AttributeTextBoxStyle}"
                             IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Балансовый счет -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Балансовый счет:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.Balance, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Номенклатурная группа -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номенклатурная группа:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <ComboBox Grid.Column="1" 
                              ItemsSource="{Binding model.NomenclatureGroups}"
                              SelectedItem="{Binding model.SelectedNomenclatureGroup, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource AttributeComboBoxStyle}"
                              ItemContainerStyle="{StaticResource AttributeComboBoxItemStyle}"
                              IsEnabled="{Binding CanEditOrderFields}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding GroupNameWithGroup}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Тип оснастки -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Тип оснастки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <ComboBox Grid.Column="1"
                  ItemsSource="{Binding model.EquipmentTypes}"
                  SelectedItem="{Binding model.SelectedEquipmentType, UpdateSourceTrigger=PropertyChanged}"
                  DisplayMemberPath="."
                  Style="{StaticResource AttributeComboBoxStyle}"
                  ItemContainerStyle="{StaticResource AttributeComboBoxItemStyle}"
                  IsEnabled="{Binding CanEditOrderFields}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Чертеж по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Чертеж:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                 Text="{Binding model.CurrentItem.DraftByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Style="{StaticResource AttributeTextBoxStyle}"
                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Наименование чертежа по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Чертежное обозн. спецификации:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.DraftNameByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Склад по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Склад:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                 Text="{Binding model.CurrentItem.WorkshopByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Style="{StaticResource AttributeTextBoxStyle}"
                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>
                        <Separator>
                            <Separator.Style>
                                <Style TargetType="Separator" BasedOn="{StaticResource AttributeSeparatorStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <!-- Количество по служебной -->
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid" BasedOn="{StaticResource AttributeRowStyle}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ShowMemoFieldsOrView}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Количество:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>
                            <TextBox Grid.Column="1" 
                                 Text="{Binding model.CurrentItem.EquipmentRequiredQuantityByMemo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource AttributeTextBoxStyle}"
                                 IsReadOnly="{Binding CanEditOrderFields, Converter={StaticResource InverseBooleanConverter}}"/>
                        </Grid>

                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>

        <!-- Правая панель с подзаказами и деталями чертежа -->
        <Border Grid.Column="2" 
                Margin="5,5,5,5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource GreenAccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4"
                Padding="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="{Binding model.CurrentGroup.Zak1, StringFormat='Тех. заказ: {0}'}"
                           FontSize="16" FontWeight="Bold" HorizontalAlignment="Center"
                           Foreground="{DynamicResource TextBrush}" Margin="0,0,0,10"/>

                <DataGrid Grid.Row="1"
                  ItemsSource="{Binding model.CurrentGroup.Items}"
                  SelectedItem="{Binding model.CurrentItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                  AutoGenerateColumns="False" 
                  CanUserAddRows="False"
                  HeadersVisibility="Column" 
                  SelectionMode="Single" 
                  Margin="0,0,0,5">
                    <!-- DataGrid всегда только для чтения, управление через стили -->
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Чертеж" 
                            Binding="{Binding EquipmentDraft}" 
                            Width="Auto"
                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="Наименование" 
                            Binding="{Binding EquipmentNameFromTechnologist}" 
                            Width="Auto" 
                            CellStyle="{DynamicResource LeftAlignedDataGridCell}"
                            IsReadOnly="True"/>
                        <DataGridTextColumn Header="Сколько изготовить" 
                            Binding="{Binding EquimentRequiredQuantity}" 
                            MaxWidth="100" 
                            Width="Auto"
                            IsReadOnly="True"/>
                        <DataGridCheckBoxColumn Header="Кооп." 
                                Binding="{Binding Cooperation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                MaxWidth="55" 
                                Width="Auto" 
                                ElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"
                                EditingElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"/>
                        <DataGridCheckBoxColumn Header="Удалить" 
                                Binding="{Binding IsDeletedFromOrder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                Width="*" 
                                ElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}" 
                                EditingElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <Border Grid.Row="2" 
                        BorderThickness="2" 
                        BorderBrush="Red" 
                        Background="{DynamicResource SecondaryBackgroundBrush}" 
                        CornerRadius="4" 
                        Padding="5">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid IsSharedSizeScope="True">
                            <StackPanel>
                                <TextBlock Text="Данные чертежа" 
                                           FontSize="16" 
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center" 
                                           Foreground="{DynamicResource TextBrush}" 
                                           Margin="0"/>

                                <Grid Style="{StaticResource AttributeRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                        <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                        <TextBlock Text="Доп. сведения для проектирования:" Style="{StaticResource AttributeLabelTextStyle}"/>
                                    </Border>

                                    <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.DesignComment}" TextWrapping="Wrap" Style="{StaticResource AttributeValueStyle}"/>
                                </Grid>

                                <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                                <!-- Дополнительные сведения для производства -->
                                <Grid Style="{StaticResource AttributeRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                        <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                        <TextBlock Text="Доп. сведения для производства:" Style="{StaticResource AttributeLabelTextStyle}"/>
                                    </Border>

                                    <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.ManufacturingComment}" TextWrapping="Wrap" Style="{StaticResource AttributeValueStyle}"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>