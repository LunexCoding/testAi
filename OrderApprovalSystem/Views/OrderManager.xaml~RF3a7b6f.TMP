<UserControl x:Class="OrderApprovalSystem.Views.OrderManager"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ribbon="clr-namespace:System.Windows.Controls.Ribbon;assembly=System.Windows.Controls.Ribbon"
        xmlns:local="clr-namespace:OrderApprovalSystem.Views"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:behaviors="clr-namespace:OrderApprovalSystem.Core.UI.Behaviors"
        xmlns:converters="clr-namespace:OrderApprovalSystem.Converters"     
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Foreground="{DynamicResource TextBrush}">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:CallMethodAction TargetObject="{Binding}" MethodName="viewLoaded"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.35*"/>
            <ColumnDefinition Width="0.3*"/>
            <ColumnDefinition Width="0.35*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" 
                Margin="5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource AccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Заголовок таблицы -->
                <Border Grid.Row="0"
                        Background="{DynamicResource AccentBrush}"
                        CornerRadius="2,2,0,0"
                        Padding="10">
                    <TextBlock Text="Технологические заказы"
                               Foreground="White"
                               FontSize="14"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"/>
                </Border>

                <!-- DataGrid с группами заказов -->
                <DataGrid Grid.Row="1"
                          IsReadOnly="True"
                          AutoGenerateColumns="False"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          HorizontalScrollBarVisibility="Disabled"
                          CanUserAddRows="False"
                          x:Name="dgReport" 
                          ItemsSource="{Binding model.GroupedData}" 
                          SelectedItem="{Binding model.CurrentGroup, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                    <i:Interaction.Behaviors>
                        <behaviors:ScrollIntoViewBehavior SelectedItem="{Binding model.CurrentGroup, Mode=OneWay}"/>
                    </i:Interaction.Behaviors>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Заказ" 
                                            Binding="{Binding Zak1}" 
                                            Width="80"/>
                        <DataGridTextColumn Header="Кол-во чертежей в заказе" 
                                            Binding="{Binding Items.Count}" 
                                            Width="100"/>
                        <DataGridTextColumn Header="Дата" 
                                            Binding="{Binding Items[0].OpenAtByTechnologist, StringFormat=\{0:dd.MM.yyyy\}}" 
                                            Width="Auto"/>
                        <DataGridTextColumn Header="Чертеж ДСЕ" 
                                            Binding="{Binding Items[0].Draft}" 
                                            Width="Auto"/>
                        <DataGridTextColumn Header="Наименование" 
                                            Binding="{Binding Items[0].DraftName}" 
                                            Width="*"
                                            CellStyle="{DynamicResource LeftAlignedDataGridCell}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Центральная область - поля информации об основном заказе -->
        <Border Grid.Column="1" 
                Margin="0,5,0,5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource GreenAccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4"
                Padding="5">

            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid IsSharedSizeScope="True">
                    <StackPanel>

                        <TextBlock Text="Данные заказа"
                                   FontSize="16"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Center"
                                    Foreground="{DynamicResource TextBrush}"
                                    Margin="0"/>

                        <!-- Технолог -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Технолог:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" 
                                       Text="{Binding model.CurrentGroup.Items[0].Technologist}" 
                                       Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Изделие -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Изделие:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.CoreDraft}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Наименование изделия -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование изделия:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.CoreDraftName}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Деталь -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Деталь:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Draft}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Наименование детали -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование детали:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.DraftName}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Цех получатель -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Цех получ.:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Workshop}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Кладовая -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Кладовая:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Warehouse}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Рабочее место -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Раб. место:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Workplace}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Операция -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Операция:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Operation}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Наименование оснастки -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" 
                                            Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Наименование оснастки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.EquipmentName}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Аналог -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Аналог:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.Analog}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                        <!-- Количество оснастки на операцию -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Кол-во оснастки на операцию:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.EquipmentQuantityForOperation}" Style="{StaticResource AttributeValueStyle}"/>
                        </Grid>

                        <!-- Номер служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номер служебной записки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
                             Text="{Binding model.CurrentItem.MemoNumber}" 
                             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                        <!-- Автор служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Автор служебной записки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
             Text="{Binding model.CurrentItem.MemoAuthor}" 
             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                        <!-- Заказ по служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Заказ по служебной:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
             Text="{Binding model.CurrentItem.OrderByMemo}" 
             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                        <!-- Номер по служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номер по служебной:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
             Text="{Binding model.CurrentItem.NumberByMemo}" 
             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                        <!-- Номенклатурная группа -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Номенклатурная группа:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <Grid>
                                <ComboBox x:Name="NomenclatureGroupComboBox"
              ItemsSource="{Binding NomenclatureGroups}"
              SelectedItem="{Binding model.CurrentItem.NomenclatureGroup, UpdateSourceTrigger=PropertyChanged}"
              Opacity="0"/>

                                <Border Background="White"
            BorderBrush="{DynamicResource AccentBrush}"
            BorderThickness="1"
            CornerRadius="3"
            Margin="5,2,10,2"
            Padding="2">
                                    <TextBlock Text="{Binding PlaceholderText}"
                   Foreground="Gray"
                   VerticalAlignment="Center"
                   Margin="2,0"/>
                                </Border>
                            </Grid>
                        </Grid>

                        <!-- Тип оснастки -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Тип оснастки:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <ComboBox ItemsSource="{Binding EquipmentTypes}"
          SelectedItem="{Binding model.CurrentItem.EquipmentType, UpdateSourceTrigger=PropertyChanged}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding TypeName}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                                </ComboBox>
                        </Grid>

                        <!-- Чертеж по служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Чертеж:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
             Text="{Binding model.CurrentItem.DraftByMemo}" 
             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                        <!-- Наименование чертежа по служебной -->
                        <Grid Style="{StaticResource AttributeRowStyle}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                <TextBlock Text="Чертежное обозн. спецификации:" Style="{StaticResource AttributeLabelTextStyle}"/>
                            </Border>

                            <TextBox Grid.Column="1" 
             Text="{Binding model.CurrentItem.DraftNameByMemo}" 
             Style="{StaticResource AttributeTextBoxStyle}"/>
                        </Grid>

                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>

        <!-- Правая область (30%) с DataGrid подзаказов и детальной информацией -->
        <Border Grid.Column="2" 
                Margin="5,5,5,5" 
                BorderThickness="2" 
                BorderBrush="{DynamicResource GreenAccentBrush}" 
                Background="{DynamicResource SecondaryBackgroundBrush}"
                CornerRadius="4"
                Padding="5">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Заголовок тех.заказа -->
                    <RowDefinition Height="Auto"/>
                    <!-- DataGrid подзаказов -->
                    <RowDefinition Height="*"/>
                    <!-- Детальная информация -->
                </Grid.RowDefinitions>

                <!-- Заголовок с номером текущего тех.заказа -->
                <TextBlock Grid.Row="0"
                           Text="{Binding model.CurrentGroup.Zak1, StringFormat='Тех. заказ: {0}'}"
                           FontSize="16"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="{DynamicResource TextBrush}"
                           Margin="0,0,0,10"/>

                <!-- DataGrid подзаказов -->
                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding model.CurrentGroup.Items}"
                          SelectedItem="{Binding model.CurrentItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          Margin="0,0,0,5">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Чертеж" Binding="{Binding EquipmentDraft}" Width="Auto"/>
                        <DataGridTextColumn Header="Наименование" Binding="{Binding EquipmentNameFromTechologist}" Width="Auto" CellStyle="{DynamicResource LeftAlignedDataGridCell}"/>
                        <DataGridTextColumn Header="Сколько изготовить" Binding="{Binding EquimentRequiredQuantity}" MaxWidth="100" Width="Auto"/>
                        <DataGridCheckBoxColumn Header="Кооп." 
                        Binding="{Binding Cooperation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                        MaxWidth="55" 
                        Width="Auto"
                        ElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"
                        EditingElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"/>
                        <DataGridCheckBoxColumn Header="Удалить из заказа" Binding="{Binding IsDeletedFromOrder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="*"
                                                ElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}" 
                                                EditingElementStyle="{StaticResource ConditionalCheckBoxColumnStyle}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Детальная информация -->
                <Border Grid.Row="2"
                        BorderThickness="2" 
                        BorderBrush="Red" 
                        Background="{DynamicResource SecondaryBackgroundBrush}"
                        CornerRadius="4"
                        Padding="5">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <!-- Главный контейнер с включенным SharedSizeScope -->
                        <Grid IsSharedSizeScope="True">
                            <StackPanel>
                                <TextBlock Grid.Row="0"
                           Text="Данные чертежа"
                           FontSize="16"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           Foreground="{DynamicResource TextBrush}"
                           Margin="0"/>

                                <!-- Дополнительные сведения для проектирования -->
                                <Grid Style="{StaticResource AttributeRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                        <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                        <TextBlock Text="Доп. сведения для проектирования:" Style="{StaticResource AttributeLabelTextStyle}"/>
                                    </Border>

                                    <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.DesignComment}" TextWrapping="Wrap" Style="{StaticResource AttributeValueStyle}"/>
                                </Grid>

                                <Separator Style="{StaticResource AttributeSeparatorStyle}"/>

                                <!-- Дополнительные сведения для производства -->
                                <Grid Style="{StaticResource AttributeRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Style="{StaticResource AttributeLabelColumnStyle}"/>
                                        <ColumnDefinition Style="{StaticResource AttributeValueColumnStyle}"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Style="{StaticResource AttributeLabelBorderStyle}">
                                        <TextBlock Text="Доп. сведения для производства:" Style="{StaticResource AttributeLabelTextStyle}"/>
                                    </Border>

                                    <TextBlock Grid.Column="1" Text="{Binding model.CurrentItem.ManufacturingComment}" TextWrapping="Wrap" Style="{StaticResource AttributeValueStyle}"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>
    </Grid>
    </UserControl>