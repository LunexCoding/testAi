<local:BaseCustomWindow x:Class="OrderApprovalSystem.Views.Main"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ribbon="clr-namespace:System.Windows.Controls.Ribbon;assembly=System.Windows.Controls.Ribbon"
        xmlns:local="clr-namespace:OrderApprovalSystem.Views"
        xmlns:vm="clr-namespace:OrderApprovalSystem.ViewModels"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:behaviors="clr-namespace:OrderApprovalSystem.Behaviors"
        xmlns:converters="clr-namespace:OrderApprovalSystem.Converters"
        Title="{Binding WindowTitle}" 
        Height="700" Width="1500"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Foreground="{DynamicResource TextBrush}">

    <Window.Resources>
        <!-- Конвертер Boolean to Visibility -->
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>

        <DataTemplate DataType="{x:Type vm:vmOrderApproval}">
            <local:OrderApprovalView />
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:vmDev}">
            <local:Dev />
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:vmGuest}">
            <local:Guest />
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:vmApprovalHistory}">
            <local:ApprovalHistory />
        </DataTemplate>

    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Единый Ribbon для всех режимов -->
        <ribbon:Ribbon x:Name="MainRibbon" 
                       Style="{StaticResource ModernRibbonStyle}" 
                       Grid.Row="1">

            <i:Interaction.Behaviors>
                <local:RibbonTabBehavior CurrentViewModel="{Binding CurrentViewModel}"/>
            </i:Interaction.Behaviors>

            <!-- ApplicationMenu - видно всегда, кроме режима истории -->
            <ribbon:Ribbon.ApplicationMenu>
                <ribbon:RibbonApplicationMenu 
                    SmallImageSource="https://cdn-icons-png.flaticon.com/512/2311/2311523.png"
                    Visibility="{Binding IsBurgerMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}">

                    <ribbon:RibbonApplicationMenuItem Header="Режим разработчика" 
                                           Command="{Binding pSwitchToDevCommand}"
                                           Visibility="{Binding IsDevMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                    <ribbon:RibbonApplicationMenuItem Header="Режим технолога" 
                                           Command="{Binding pSwitchToTechnologistCommand}"
                                           Visibility="{Binding IsTechnologistMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    <ribbon:RibbonApplicationMenuItem Header="Режим менеджера заказов" 
                       Command="{Binding pSwitchToOrderManagerCommand}"
                       Visibility="{Binding IsOrderManagerMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    <ribbon:RibbonApplicationMenuItem Header="Режим начальника отдела заказов" 
                                           Command="{Binding pSwitchToHeadOrderDepartmentCommand}"
                                           Visibility="{Binding IsHeadOrderDepartmentMenuVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </ribbon:RibbonApplicationMenu>
            </ribbon:Ribbon.ApplicationMenu>

            <!-- Вкладка ВИД - видна только не в режиме истории -->
            <ribbon:RibbonTab Header="ВИД" 
                              Visibility="{Binding ShowRegularTabs, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ribbon:RibbonGroup Header="Оформление">
                    <ribbon:RibbonToggleButton Label="Темная тема"
                                                IsChecked="{Binding IsDarkTheme}"/>
                </ribbon:RibbonGroup>
            </ribbon:RibbonTab>
            
        </ribbon:Ribbon>

        <!-- Основной контент -->
        <ContentControl Grid.Row="2" Content="{Binding CurrentViewModel, Mode=OneWay}"/>

    </Grid>
</local:BaseCustomWindow>